# CI/CD 파이프라인 문서

## 개요

이 문서는 DB2 프로젝트의 CI/CD 파이프라인 구조와 배포 전략에 대해 설명합니다. 이 프로젝트는 GitHub Actions를 사용하여 자동화된 테스트, 빌드 및 배포 프로세스를 구현합니다.

## 환경 구성

프로젝트는 다음 세 가지 환경으로 구성됩니다:

1. **개발 환경 (Development)**
   - Firebase 프로젝트: `db888-dev`
   - URL: https://db888-dev.web.app
   - 용도: 기능 개발 및 초기 테스트

2. **스테이징 환경 (Staging)**
   - Firebase 프로젝트: `db888-staging`
   - URL: https://db888-staging.web.app
   - 용도: 통합 테스트 및 사용자 수용 테스트(UAT)

3. **프로덕션 환경 (Production)**
   - Firebase 프로젝트: `db888`
   - URL: https://db888.web.app
   - 용도: 최종 사용자 서비스 제공

## 워크플로우 구성

### PR 검증 (PR Validation)

- **트리거**: Pull Request가 `main` 또는 `develop` 브랜치로 생성될 때
- **목적**: 코드 품질 검증 및 테스트
- **단계**:
  1. 코드 린팅
  2. 단위 테스트 실행
  3. 통합 테스트 실행 (Firebase 에뮬레이터 사용)
  4. 번들 사이즈 검사
  5. 보안 취약점 검사

### 개발 환경 배포 (Deploy to Development)

- **트리거**: `develop` 브랜치로 푸시될 때
- **목적**: 개발 환경에 자동 배포
- **단계**:
  1. 코드 테스트 및 빌드
  2. Firebase Functions 및 Hosting 배포
  3. 배포 후 검증 테스트 실행
  4. Slack 알림 전송

### 스테이징 환경 배포 (Deploy to Staging)

- **트리거**: `main` 브랜치로 푸시될 때 또는 수동 실행
- **목적**: 스테이징 환경에 단계적 배포
- **단계**:
  1. 코드 테스트 및 빌드
  2. 카나리 배포 (10% 트래픽)
  3. 스모크 테스트 실행
  4. 전체 배포
  5. 배포 후 검증 테스트 실행
  6. Slack 알림 전송
  7. 실패 시 자동 롤백

### 프로덕션 환경 배포 (Deploy to Production)

- **트리거**: 릴리즈 생성 또는 수동 실행
- **목적**: 프로덕션 환경에 안전한 배포
- **단계**:
  1. 배포 준비 및 테스트
  2. 배포 승인 대기
  3. 카나리 배포 (5% 트래픽)
  4. 부분 배포 (50% 트래픽)
  5. 전체 배포
  6. 배포 후 검증 테스트 실행
  7. Slack 알림 전송
  8. 실패 시 자동 롤백

## 배포 전략

### 단계적 배포 (Progressive Deployment)

프로덕션 환경에 대한 배포는 다음과 같은 단계적 접근 방식을 따릅니다:

1. **카나리 배포 (5%)**
   - 소수의 사용자에게만 새 버전 제공
   - 문제 발생 시 영향 최소화

2. **부분 배포 (50%)**
   - 성공적인 카나리 배포 후 더 많은 사용자에게 확장
   - 부하 테스트 및 성능 모니터링

3. **전체 배포 (100%)**
   - 성공적인 부분 배포 후 모든 사용자에게 배포

### 배포 승인 프로세스

프로덕션 환경에 대한 모든 배포는 다음과 같은 승인 프로세스를 거칩니다:

1. 배포 준비가 완료되면 승인 대기 상태로 전환
2. 승인 권한이 있는 팀원의 명시적 승인 필요
3. 승인 없이 24시간이 경과하면 배포 자동 취소

### 롤백 메커니즘

모든 환경에는 자동 롤백 메커니즘이 구현되어 있습니다:

1. 배포 후 검증 테스트가 실패하면 자동으로 이전 버전으로 롤백
2. Firebase CLI의 `functions:rollback` 및 `hosting:rollback` 명령 활용
3. 롤백 발생 시 Slack을 통해 팀에 자동 알림

## 모니터링 및 알림

### 배포 알림

모든 배포 이벤트는 다음과 같은 알림을 생성합니다:

1. 배포 시작: 배포가 시작될 때 Slack 알림
2. 배포 성공: 배포가 성공했을 때 Slack 알림 (환경 URL 포함)
3. 배포 실패: 배포가 실패했을 때 Slack 알림 (로그 링크 포함)
4. 롤백 발생: 롤백이 발생했을 때 Slack 알림

### 배포 모니터링

배포 후 다음과 같은 모니터링이 수행됩니다:

1. Firebase Functions 오류 모니터링
2. 응답 시간 및 성능 메트릭 모니터링
3. 사용자 경험 측정 (Core Web Vitals)

## 비상 대응 절차

### 배포 실패 시 절차

1. 자동 롤백 시스템이 작동하여 이전 버전으로 복원
2. 온콜 엔지니어에게 자동 알림 전송
3. 실패 원인 분석 및 해결 방안 수립

### 수동 롤백 방법

자동 롤백이 실패하는 경우 다음과 같은 수동 롤백 절차를 따릅니다:

```bash
# Firebase Functions 롤백
firebase use <project-id>
firebase functions:rollback

# Firebase Hosting 롤백
firebase hosting:rollback
```

## 시크릿 및 환경 변수 관리

모든 환경 변수와 시크릿은 GitHub Actions 시크릿으로 안전하게 저장됩니다:

1. 데이터베이스 연결 정보 (DB_HOST, DB_USER, DB_PASSWORD, DB_NAME)
2. Firebase 토큰 (FIREBASE_TOKEN)
3. Slack 알림 토큰 및 채널 ID

각 환경에 대한 시크릿은 GitHub 환경 시크릿으로 분리되어 관리됩니다.

## 권장 사항 및 모범 사례

1. 모든 코드 변경 사항은 Pull Request를 통해 검토 후 병합
2. 중요한 변경 사항은 개발 환경에서 충분히 테스트 후 스테이징으로 승격
3. 프로덕션 배포는 가능한 한 정규 근무 시간 중에 수행
4. 매주 정기 배포 일정을 수립하여 예측 가능성 확보

## 연락처 및 지원

배포 관련 문제 발생 시 다음 연락처로 문의하세요:

- 기술 책임자: [담당자 이름]
- DevOps 담당자: [담당자 이름]
- 온콜 연락처: [연락처]
